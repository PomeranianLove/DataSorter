# DataSoter VBA

Excelデータを支払先コード×種別で自動仕分けするVBAアドインです。大量データの高速処理と確実な保存を実現します。
設計とコードレビューを制作者が行いコーディングをClaudeAIが行っています。
汎用的な設計にしていますが、対象となる箇所はハードコーディングされており対象カラムの増減には非対応です。
総デバッグレコード数300万レコード＋
Max 90万レコード882パターンを一括処理時成功率100％、リトライ回数０、処理時間 3時間14分35秒

## 特徴

- **大量データ対応**: 50万レコード24パターンを約5分で処理
- **自動フォルダ分類**: 種別ごとにフォルダを自動作成
- **詳細レポート**: 成功/失敗の詳細サマリーを出力
- **環境最適化**: PC性能に応じた設定調整

## 出力形式

```
選択したルートフォルダ/
├── Sales/                    # 営業フォルダ
│   ├── A001_営業.xlsx       # 支払先コード_種別.xlsx
│   └── B002_営業.xlsx
├── Accounting/               # 経理フォルダ
│   └── C003_経理.xlsx
├── summary/                  # サマリーフォルダ
│   └── 元ファイル名_summary.txt
└── log/                      # ログフォルダ (デバッグ時)
    └── 元ファイル名_log_YYYYMMDDHHMM.txt
```

## インストール

1. VBAファイル（.bas, .cls）をExcelにインポート
2. マクロのセキュリティ設定を有効に設定
3. `DataSorter()` を実行

## 使用方法

### 基本操作

1. **マクロ実行**: `DataSorter()` を実行
2. **保存先選択**: ルートディレクトリを選択
3. **処理待機**: 進捗をステータスバーで確認
4. **完了確認**: サマリーファイルで結果を確認

### 種別フォルダ対応表

| 種別 | 出力フォルダ名 |
|------|----------------|
| 営業 | Sales |
| 経理 | Accounting |
| 総務 | General |
| 開発 | Development |
| マーケティング | Marketing |
| サポート | Support |

## 設定カスタマイズ

### 環境別最適化
環境によって処理時の各種遅延が異なります。
PCスペックやストレージの環境次第で調整を行ってください。
メイン関数内に設定されているプリセットはデフォルトで無効化されており、デフォルトではConfigの遅延設定の値が使用されます。

```vba
' 高速ローカル環境
config.ApplyEnvironmentSettings "FAST"

' クラウド環境
config.ApplyEnvironmentSettings "CLOUD"

' ネットワーク環境  
config.ApplyEnvironmentSettings "NETWORK"

```

## サマリーレポート例

```
データ仕分け処理レポート
処理日時: 2025/08/03 14:30:45
対象ブック: sample_data.xlsx
======================================================================

【処理結果サマリー】
全処理件数: 15
成功件数: 13
失敗件数: 2
成功率: 86.7%

----------------------------------------------------------------------

【成功した処理】
種別                支払先コード      件数
--------------------------------------------------
営業                A001            5
営業                B002            3
経理                C003            8

【失敗した処理】
種別                支払先コード      シート名            失敗時刻
----------------------------------------------------------------------
マーケティング      E005            月次報告書          2025/08/03 14:28:12
```

## 障害対応

### 処理が途中で停止した場合

1. **ログファイル確認**: `log/元ファイル名_log_YYYYMMDDHHMM.txt` で最後の成功処理を確認
2. **手動削除**: 不完全な出力ファイルを手動で削除
3. **再実行**: 元データから全て再実行

## アーキテクチャ

### ファイル構成

- `ConfigManager.cls`: 設定管理クラス
- `DebugLogger.cls`: ログ管理クラス  
- `DataSorterMain.bas`: メイン処理モジュール

### 処理フロー

```
データ読み込み → フィルタリング → ファイル作成 → 保存確認 → サマリー出力
```

### 保存確認メカニズム

1. ファイル保存実行
2. ワークブック閉じる
3. ファイル再オープン
4. 期待するシート名・データの存在確認
5. 確認ファイル閉じる
6. 成功/失敗判定

## パフォーマンス

### 実測値
- **処理速度**: 約1,500件/秒
- **メモリ使用量**: 効率的なDictionary使用で最適化
- **安定性**: 50万件で100%成功率

## ライセンス

MIT License - 商用利用、改変、再配布すべて自由です。

## サポート

企業での利用時は、以下の点をご確認ください：

- マクロのセキュリティ設定
- 出力先フォルダの権限設定  
- データ形式の統一
